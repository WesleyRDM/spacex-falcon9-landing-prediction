# -*- coding: utf-8 -*-
"""SQL_Analysis.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1QRb4vpp-gz_xyrZZyOhw_Q5GBt0LakKM
"""

# Commented out IPython magic to ensure Python compatibility.
# %load_ext sql

import csv, sqlite3
import prettytable
prettytable.DEFAULT = 'DEFAULT'

con = sqlite3.connect("my_data1.db")
cur = con.cursor()

# Commented out IPython magic to ensure Python compatibility.
# %sql sqlite:///my_data1.db

import pandas as pd
df = pd.read_csv("https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBM-DS0321EN-SkillsNetwork/labs/module_2/data/Spacex.csv")
df.to_sql("SPACEXTBL", con, if_exists='replace', index=False,method="multi")

df['Landing_Outcome'].value_counts()

# Commented out IPython magic to ensure Python compatibility.
# %sql DROP TABLE IF EXISTS SPACEXTABLE;

# Commented out IPython magic to ensure Python compatibility.
# %sql create table SPACEXTABLE as select * from SPACEXTBL where Date is not null

cur.execute('SELECT Launch_Site FROM SPACEXTBL')
cur.fetchall()

cur.execute('''SELECT Launch_Site
               FROM SPACEXTABLE
               WHERE Launch_Site
               LIKE 'CCA%' LIMIT 5;''')
cur.fetchall()

cur.execute('''SELECT SUM(PAYLOAD_MASS__KG_)
               AS TotalPayloadMass
               FROM SPACEXTABLE
               WHERE Customer = 'NASA (CRS)';''')
cur.fetchall()

cur.execute('''SELECT AVG(PAYLOAD_MASS__KG_) AS AvgPayloadMass
               FROM SPACEXTABLE
               WHERE Booster_Version = 'F9 v1.1';''')
cur.fetchall()

cur.execute('''SELECT MIN(Date) AS FirstGroundPadSuccess
               FROM SPACEXTABLE
               WHERE Mission_Outcome  = 'Success';''')
cur.fetchall()

cur.execute('''SELECT Booster_Version
               FROM SPACEXTABLE
               WHERE Landing_Outcome = 'Success (drone ship)'
               AND PAYLOAD_MASS__KG_ > 400
               AND PAYLOAD_MASS__KG_ < 600;''')
cur.fetchall()

cur.execute('''SELECT COUNT(Mission_Outcome)
               FROM SPACEXTABLE''')
cur.fetchall()

cur.execute('''
    SELECT Booster_Version
    FROM SPACEXTABLE
    WHERE PAYLOAD_MASS__KG_ = (
        SELECT MAX(PAYLOAD_MASS__KG_)
        FROM SPACEXTABLE
    );
''')

cur.fetchall()

cur.execute("""
    SELECT
        substr(Date, 6, 2) AS Month,
        Landing_Outcome,
        Booster_Version,
        Launch_Site
    FROM SPACEXTABLE
    WHERE substr(Date, 0, 5) = '2015'
    AND Landing_Outcome = 'Failure (drone ship)'
""")

cur.fetchall()

cur.execute("""
    SELECT
        Landing_Outcome,
        COUNT(*) AS Outcome_Count
    FROM SPACEXTABLE
    WHERE Date BETWEEN '2010-06-04' AND '2017-03-20'
    GROUP BY Landing_Outcome
    ORDER BY Outcome_Count DESC;
""")

cur.fetchall()